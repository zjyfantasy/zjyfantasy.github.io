<!DOCTYPE html>
<html lang="en">
<head>
    <title>62 Unity Project</title>
    <!-- Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src * ws: wss: gap: data: file: http: https: blob:; style-src * 'unsafe-inline' ws: wss: gap: data: file: http: https: blob:; script-src * 'unsafe-inline' 'unsafe-eval' ws: wss: gap: data: file: http: https: blob:" />
    <!-- Caches -->
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Default -->
    <meta name="edge" content="IE=edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, shrink-to-fit=no, user-scalable=no, viewport-fit=cover">
    <meta name="browsermode" content="application">
    <meta name="description" content="62 Unity Project">
    <meta name="theme-color" content="#2A2342">
    <!-- Apple -->
    <meta name="apple-mobile-web-app-title" content="62 Unity Pro">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!-- Android  -->
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Windows  -->
    <meta name="application-name" content="62 Unity Project">
    <meta name="msapplication-navbutton-color" content="#2A2342">
    <meta name="msapplication-tooltip" content="62 Unity Project">
    <meta name="msapplication-starturl" content=".">
    <meta name="msapplication-TileColor" content="#2A2342">
    <meta name="msapplication-tap-highlight" content="no">
    <!-- Favorite -->
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <!-- Toaster - https://github.com/dolce/iziToast -->
    <link href="css/toaster.css" rel="stylesheet" type="text/css">
    
    <style nonce="none">
        html, body {
            position: absolute;
            min-height: 100%;
            width: 100%;
            height: 100%;
            padding: 0px;
            margin: 0px;
            overflow: hidden;
            touch-action: none;
            font-family: "Segoe UI", "Segoe WP", "Verdana", "Arial";
            background-color: #2A2342;
        }
        #panel {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 100px;
            min-width: 400px;
            min-height: 100px;
            margin-top: -50px;
            margin-left: -200px;
            z-index: 1000;
        }
        #proj {
            margin: 0px;
            padding: 0px;
            padding-bottom: 14px;
            z-index: 1001;
            font-size: 14px;
            text-align: center;
            color: #F3F3F3;
            outline: none;
            overflow: hidden;
        }
        #status {
            position: absolute;
            top: 50%;
            left:50%;
            margin: 0px;
            padding: 0px;
            padding-top: 30px;
            z-index: 1001;
            width: 100px;
            min-width: 100px;
            margin-top: -10px;
            margin-left: -50px;
            font-size: 10px;
            text-align: center;
            color: #F3F3F3;
            outline: none;
            overflow: hidden;
        }
        #details {
            margin: 0px;
            padding: 0px;
            padding-top: 14px;
            z-index: 1001;
            font-size: 12px;
            text-align: center;
            color: #F3F3F3;
            outline: none;
            overflow: hidden;
        }
        #cvs {
            position: absolute;
            min-height: 100%;
            width: 100%;
            height: 100%;
            padding: 0px;
            margin: 0px;
            z-index: 0;
            opacity: 0;
            outline: none;
            overflow: hidden;
        }
        .load {
            border: 4px solid #F3F3F3;
            border-top: 4px solid #E0684B;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            z-index: 1001;
            animation: spin 2s linear infinite;
        }
        .data {
            border: 4px solid #F3F3F3;
            border-top: 4px solid #00FF00;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            z-index: 1001;
            animation: spin 2s linear infinite;
        }
        .hidden { display: none; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #babylonUnmuteIconBtn {
            display: block !important;
        }        
    </style>
    <script type="text/javascript" nonce="none">
    </script>
</head>
<body touch-action="none">
    <!-- ******************************** -->
    <!-- CUSTOM: Loader for this template -->
    <!-- ******************************** -->
    <div id="panel">
        <center>
            <div id="proj">62 Unity Project</div>
            <div id="load" class="load"></div>
            <div id="status">Loading</div>
            <div id="details">Loading script files</div>
        </center>
    </div>
    <!-- ******************************** -->
    <!-- CANVAS: Markup for this template -->
    <!-- ******************************** -->
    <canvas id="cvs"></canvas>
    <!-- ******************************** -->
    <!-- SCRIPT: Markup for this template -->
    <!-- ******************************** -->
    <script type="text/javascript" src="scripts/fastclick.js"></script>
    <script type="text/javascript" src="scripts/toaster.js"></script>
    <script type="text/javascript" src="scripts/meter.js"></script>
    <script type="text/javascript" src="scripts/pep.js"></script>

    

    <!-- Engine Libraries -->
    <script type="text/javascript" src="scripts/babylon.min.js"></script>
    <script type="text/javascript" src="scripts/babylon.gui.js"></script>
    <script type="text/javascript" src="scripts/babylon.gltf.js"></script>
    <script type="text/javascript" src="scripts/babylon.earcut.js"></script>

    <!-- Support Libraries -->
	<script type="text/javascript" src="scripts/ammo.js"></script>
	<script type="text/javascript" src="scripts/recast.js"></script>
	<script type="text/javascript" src="scripts/babylon.inspector.js"></script>

    <!-- Manager Libraries -->
    <script type="text/javascript" src="scripts/babylon.manager.js"></script>
    <script type="text/javascript" src="scripts/babylon.materials.js"></script>

    <!-- Project Script Bundle -->
    <script type="text/javascript" src="scenes/62UnityProject.js"></script>

    <!-- Default Scene Loader -->
    <script type="text/javascript" nonce="none">
    window.getUrlParameter = (name) => {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(window.location.search);
        return (results !== null) ? decodeURIComponent(results[1].replace(/\+/g, ' ')) : null;
    };
    ///////////////////////////////////////////////////////////
    // Babylon Service Worker Hooks
    ///////////////////////////////////////////////////////////
    window.versionStamp = '33c89ec2-b747-4d2e-a728-7e97cf71ce22';
    window.autoStartLoader = false;
    window.useServiceWorker = false;
    window.onServiceWorker = () => {
        if (window.autoStartLoader === true) {
            window.startSceneLoader();
        }
    };
    window.updateAvailable = () => {
        var msg = "A new version is available";
        console.warn(msg);
        iziToast.show({
            title: "UPDATE:",
            message: msg,
            timeout: 30000,
            buttons: [['<button>Reload</button>', function (instance, toast) { window.top.location.reload(true); }, true]]
        });    
    };
    ///////////////////////////////////////////////////////////
    window.ktx2 = false;
    window.scene = null;
    window.toolkit = true;
    var engine = null;
    var pagetype = "project", defaultscene= "Demo_62.glb", autohide = true, percent = false, offline = true, validategltf = false, handlecontext = true, physics = true, navmesh = true, renderengine = 0, antialias = true, adaptive = false, datax = "#00FF00", folder = "scenes/", title = "62 Unity Project";
    var loaded = false, paused = false, reloader = false, downloaded = 0;
    var divcvs = document.getElementById("cvs");
    var panel = document.getElementById("panel");
    var proj = document.getElementById("proj");
    var loader = document.getElementById("load");
    var label = document.getElementById("status");
    var details = document.getElementById("details");
    // ************************************************************************ //
    // QUERY STRING - Parse Root Urls And Scene Name Parameters                 //
    // ************************************************************************ //
    var rooturl = "" + (window.getUrlParameter("root") || "");
    if (rooturl != null && rooturl !== "" && !rooturl.endsWith("/")) rooturl += "/";
    var sceneurl = "" + (window.getUrlParameter("path") || folder);
    if (sceneurl != null && sceneurl !== "" && !sceneurl.endsWith("/")) sceneurl += "/";
    var scenename = "" + (window.getUrlParameter("scene") || defaultscene);
    var scenepath = "" + (rooturl + sceneurl);
    var adaptparam = window.getUrlParameter("adaptive");
    if (adaptparam != null && adaptparam !== "") {
        adaptparam = adaptparam.toLowerCase();
        adaptive = (adaptparam === "true" || adaptparam === "yes");
    }
    // ************************************************************************ //
    // STATS PANEL - Setup Performance Stats Information Panel                  //
    // ************************************************************************ //
    var showStatsPanel = false;
    if (showStatsPanel === true && typeof FPSMeter !== "undefined") {
        var anchor = 1;
        var stats = 'fps';
        var look = 'colorful';
        var atop = 'auto';
        var aleft = 'auto';
        var aright = 'auto';
        var abottom = 'auto';
        if (anchor === 0) {
            atop = '5px';
            aleft = '5px';
        } else if (anchor === 1) {
            atop = '5px';
            aright = '5px';
        } else if (anchor === 2) {
            abottom = '5px';
            aleft = '5px';
        } else if (anchor === 3) {
            abottom = '5px';
            aright = '5px';
        } else {
            atop = '5px';
            aright = '5px';
        }
        window.METER = new FPSMeter({
            interval:  100,         // Update interval in milliseconds.
            smoothing: 10,          // Spike smoothing strength. 1 means no smoothing.
            show:      stats,       // Whether to show 'fps', or 'ms' = frame duration in milliseconds.
            toggleOn:  'click',     // Toggle between show 'fps' and 'ms' on this event.
            decimals:  0,           // Number of decimals in FPS number. 1 = 59.9, 2 = 59.94, ...
            maxFps:    60,          // Max expected FPS value.
            threshold: 100,         // Minimal tick reporting interval in milliseconds.
            // ..
            // Position Options
            // ..
            position: 'absolute',   // Meter position.
            zIndex:   10,           // Meter Z index.
            top:      atop,         // Meter top offset.
            left:     aleft,        // Meter left offset.
            right:    aright,       // Meter right offset.
            bottom:   abottom,      // Meter bottom offset.
            margin:   '0 0 0 0',    // Meter margin. Helps with centering the counter when left: 50%;
            // ..
            // Theme Options
            // ..
            theme: look,            // Meter theme. Build in: 'dark', 'light', 'transparent', 'colorful'.
            heat:  1,               // Allow themes to use coloring by FPS heat. 0 FPS = red, maxFps = green.
            // ..
            // Graph Options
            // ..
            graph:   1,             // Whether to show history graph.
            history: 20             // How many history states to show in a graph.
        });
    }
    // ************************************************************************ //
    // LOADING SCREEN - Attach Project Loadeing Screen Event Handler            //
    // ************************************************************************ //
    function LoadingScreen() {};
    LoadingScreen.prototype.displayLoadingUI = function() {};
    LoadingScreen.prototype.hideLoadingUI = function() {};
    // ************************************************************************ //
    // GLTF LOADER - General Page Loading Funcitons                             //
    // ************************************************************************ //
    BABYLON.SceneLoader.OnPluginActivatedObservable.addOnce(function (loader) {
        loader.validate = validategltf;
    });
    ///////////////////////////////////////////////////////////
    // WEB SOCKETS - Default Web Socket Window Hook
    ///////////////////////////////////////////////////////////
    window.socketConnect = (connection) => {
        if (window["io"] != null) {
        if (window.state == null) window.state = {};
        window.state["socket"] = window["io"].connect(connection, {transports: ['websocket']});
        if (window.state["socket"] != null) {
            window.state["socket"].on('connect', ()=> {
            if (window.state.onSocketConnect) {
                window.state.onSocketConnect();
            }
            window.state["socket"].on('disconnect', ()=> {
                if (window.state.onSocketDisconnect) {
                window.state.onSocketDisconnect();
                }
            });
            });
        }
        }
        return (window.state != null && window.state["socket"] != null) ? window.state["socket"] : null;
    };
    // ************************************************************************ //
    // PAGE UTILTITIES - General Page Utility Funcitons                         //
    // ************************************************************************ //
    window.updateStatus = function(status, info, state) {
        if (label != null && status != null && label.innerHTML !== status) {
            label.innerHTML = status;
        }                   
        if (details != null && info != null && details.innerHTML !== info) {
            details.innerHTML = info;
        }
        // ..
        // Support Top Window Scene Loader (Note: FrameElement Check Required)
        // ..
        if (window.frameElement != null && top != null && window.top != null && window.top.updateStatus != null) {
            window.top.updateStatus(status, info, state);
        }
    };
    window.showSceneLoader = function() {
        if (panel != null) panel.className = "";
        if (proj != null) proj.className = "";
        if (label != null) label.className = "";
        if (details != null) details.className = "";
        if (loader != null) loader.className = "data";
        // ..
        divcvs.style.opacity = "0";
        engine.clear(new BABYLON.Color3(0, 0, 0), true, true);
        engine.displayLoadingUI();
        window.updateStatus("", "", 0);
    };
    window.hideSceneLoader = function() {
        if (panel != null) panel.className = "hidden";
        if (proj != null) proj.className = "hidden";
        if (label != null) label.className = "hidden";
        if (details != null) details.className = "hidden";
        if (loader != null) loader.className = "hidden";
        // ..
        engine.hideLoadingUI();
        divcvs.style.opacity = "1";
        window.updateStatus("", "", 0);
        // ..
        // Support Top Window Scene Loader (Note: FrameElement Check Required)
        // ..
        if (window.frameElement != null && top != null && window.top != null && window.top.loadSceneComplete != null) {
            window.top.loadSceneComplete();
        }
        if (BABYLON.SceneManager.OnLoadCompleteObservable.hasObservers() === true) {
            BABYLON.SceneManager.OnLoadCompleteObservable.notifyObservers(engine);
        }
    };
    window.showErrorMessage = function (message, title, timeout) {
        console.error(message);
        iziToast.error({
            message: message,
            title: title || "Error",
            timeout: timeout || 0
        });    
    };
    // ************************************************************************ //
    // SCENE LOADER - Execute Scene Loading With Progress Information           //
    // ************************************************************************ //
    window.executeSceneLoader = function(root, name) {
        var kilobyte = 1024;
        var megabyte = (kilobyte * kilobyte);
        var defaultDetails = "Loading scene content"; // DEPRECIATED: + name.toLowerCase();
        window.updateStatus("Loading", defaultDetails, 0);
        var qlevel = BABYLON.SceneManager.GetRenderQuality();
        var qlabel = "High";
        if (qlevel === 1) qlabel = "Medium";
        else if (qlevel == 2) qlabel = "Low";
        BABYLON.Tools.Log("Graphics render quality: " + qlabel);
        BABYLON.SceneLoader.Load(root, name, engine, function(newscene) {
            window.scene = newscene;
            window.scene.executeWhenReady(function() {
                loaded = true;
                engine.runRenderLoop(function() { 
                    if (BABYLON.SceneManager.RenderLoopReady === true && BABYLON.SceneManager.PauseRenderLoop === false) {
                        if (window.METER) {
                            window.METER.tickStart();
                            window.scene.render();
                            window.METER.tick();
                        } else {
                            window.scene.render();
                        }
                    }
                });
                window.resizeRenderingCanvas();
                if (autohide === true) {
                    var hideSceneLoaderHandled = (window.scene != null && window.scene.metadata != null && window.scene.metadata.unity != null && window.scene.metadata.unity.hideloader != null && window.scene.metadata.unity.hideloader === true);
                    if (!hideSceneLoaderHandled) {
                        window.setTimeout(()=>{ window.hideSceneLoader(); }, 3000); // Note: Fallback Hide Scene Loader Handler
                    }
                }
            });
        }, function(evt) {
            var pstatus = "Loading";
            var details = defaultDetails;
            var lstate = (BABYLON.Utilities != null) ? BABYLON.Utilities.GetLoadingState() : 0;
            switch (lstate) {
                case 0:     // LOAD SCENE CONTENT
                    //pstatus = "Loading";
                    //details = defaultDetails;
                    break;
                case 1:     // PARSE NODE TRANSFORMS
                    //pstatus = "Loading";
                    //details = defaultDetails;
                    break;
                case 2:     // PARSE SCENE METADATA
                    //pstatus = "Parsing";
                    //details = "Parsing scene content";
                    break;
                case 3:     // START ASSET PRELOADER
                    //pstatus = "Preload";
                    //details = "Preload scene content";
                    break;
                case 4:     // PREPARE SCENE CONTENT
                    //pstatus = "Ready";
                    //details = "Preparing scene content";
                    break;
            }
            if (evt.loaded > 0) {
                //var loadedPercent = "";
                //if (evt.lengthComputable) {
                //    loadedPercent = (evt.loaded * 100 / evt.total).toFixed() + "%";
                //} else {
                //    var dlCount = evt.loaded / (1024 * 1024);
                //    loadedPercent = (Math.floor(dlCount * 100.0) / 100.0).toFixed() + "MB";
                //}
                //console.log("Progress: " + loadedPercent);
                if (percent === true && evt.lengthComputable) {
                    var percentage = (evt.loaded * 100 / evt.total).toFixed();
                    var percentstatus = (lstate >= 2) ? pstatus : percentage + "%";
                    window.updateStatus(percentstatus, details, lstate);
                    // DEPRECIATED: var percentstatus = (lstate >= 2) ? "" : (" " + percentage + "%");
                    // DEPRECIATED: window.updateStatus(pstatus, (details + percentstatus), lstate);
                } else {
                    var units = " MB";
                    var dlCount = evt.loaded / megabyte;
                    var progress = Math.ceil(dlCount * 100.0) / 100.0;
                    // DEPRECIATED: var progress = Math.ceil(evt.loaded / megabyte);
                    if (progress >= downloaded) {
                        downloaded = progress;
                    }
                    if (downloaded > 0) {
                        if (downloaded > kilobyte) {
                            units = " GB";
                            downloaded = (downloaded / kilobyte);
                        }
                        var sizestatus = (lstate >= 2) ? pstatus : ("" + downloaded.toFixed()) + units;
                        window.updateStatus(sizestatus, details, lstate);
                        // DEPRECIATED: var sizestatus = (lstate >= 2) ? "" : (" " + downloaded.toFixed() + units);
                        // DEPRECIATED: window.updateStatus(pstatus, (details + sizestatus), lstate);
                    }
                }
            } else {
                window.updateStatus(pstatus, details, lstate);
            }
        }, function(scene, message, exception) {
            window.showErrorMessage(exception || message || ("Unknown error loading scene:" + name));
        });
    };
    window.loadSceneFile = function() {
        loaded = false;
        window.scene = null;
        window.showSceneLoader();
        window.executeSceneLoader(scenepath, scenename);
    };
    window.defaultSceneLoader = function() {
        try {
            window.loadSceneFile();
        } catch (ex2) {
            window.showErrorMessage(ex2.message || "Unknown Scene Exception");
        }
    };
    window.recastDetourLoader = function() {
        try {
            if (typeof Recast !== "undefined") {
                Recast().then(function() { defaultSceneLoader(); });
            } else {
                window.defaultSceneLoader();
            }
        } catch (ex3) {
            window.showErrorMessage(ex3.message || "Unknown Recast Exception");
        }
    };
    window.bulletPhysicsLoader = function() {
        try {
            if (typeof Ammo !== "undefined") {
                Ammo().then(function() {  recastDetourLoader(); });
            } else {
                window.recastDetourLoader();
            }
        } catch (ex4) {
            window.showErrorMessage(ex4.message || "Unknown Bullet Exception");
        }
    };
    window.startSceneLoader = function() {
        window.bulletPhysicsLoader();
    };
    // ************************************************************************ //
    // RENDER CANVAS - Engine Reseize Observer Notification                     //
    // ************************************************************************ //
    window.resizeRenderingCanvas = function() {
        if (engine != null) engine.resize();
        if (BABYLON.SceneManager.OnEngineResizeObservable.hasObservers() === true) {
            BABYLON.SceneManager.OnEngineResizeObservable.notifyObservers(engine);
        }
    };
    window.addEventListener("resize", function() { window.resizeRenderingCanvas(); });
    // ************************************************************************ //
    // BABYLON ENGINE - Create Engine And Load Project Scene Hiearchy           //
    // ************************************************************************ //
    window.setupBabylonEngineHostPage = function() {
        try {
            if (renderengine === 1) {
                if (navigator.gpu) {
                    engine = new BABYLON.WebGPUEngine(divcvs);
                    engine.initAsync({ jsPath: "scripts/glslang.js", wasmPath: "scripts/glslang.wasm" }).catch((ex) => { showErrorMessage(ex.message || "Unknown WebGPU Exception"); }).then(function() {
                        BABYLON.Tools.Log("WebGPU rendering engine enabled");
                    });
                } else {
                    BABYLON.Tools.Warn("WebGPU is not supported on platform. Falling back to WebGL");
                    engine = new BABYLON.Engine(divcvs, antialias, {premultipliedAlpha: false, doNotHandleContextLost: !handlecontext}, adaptive);
                }
            } else {
                engine = new BABYLON.Engine(divcvs, antialias, {premultipliedAlpha: false, doNotHandleContextLost: !handlecontext}, adaptive);
            }
            // ************************************************************************ //
            window.audioEngineClicked = false;    
            window.doAudioEngineClick = () => {
                if (window.audioEngineClicked === false) {
                    if (BABYLON.Engine && BABYLON.Engine.audioEngine && BABYLON.Engine.audioEngine.unlock) {
                        window.audioEngineClicked = true;
                        try { BABYLON.Engine.audioEngine.unlock(); } catch {}
                        document.removeEventListener("click", window.doAudioEngineClick);
                    }
                }
            }
            document.addEventListener("click", window.doAudioEngineClick);
            // ************************************************************************ //
            engine.loadingScreen = new LoadingScreen();
            engine.enableOfflineSupport = offline;
            engine.clear(new BABYLON.Color3(0, 0, 0), true, true);
            engine.displayLoadingUI();
            // ************************************************************************ //
            // KTX2 DECODER - Initialize Default Loader Locations                       //
            // ************************************************************************ //
            if (BABYLON.KhronosTextureContainer2 && BABYLON.KhronosTextureContainer2.URLConfig) {
                var href = window.location.href;
                var path = href.substring(0, href.lastIndexOf('/')) + "/";
                BABYLON.KhronosTextureContainer2.URLConfig.jsDecoderModule = path + "scripts/babylon.ktx2Decoder.js";
                BABYLON.KhronosTextureContainer2.URLConfig.jsMSCTranscoder = path + "scripts/msc_basis_transcoder.js";
                BABYLON.KhronosTextureContainer2.URLConfig.wasmMSCTranscoder = path + "scripts/msc_basis_transcoder.wasm";
                BABYLON.KhronosTextureContainer2.URLConfig.wasmUASTCToASTC = path + "scripts/uastc_astc.wasm";
                BABYLON.KhronosTextureContainer2.URLConfig.wasmUASTCToBC7 = path + "scripts/uastc_bc7.wasm";
                BABYLON.KhronosTextureContainer2.URLConfig.wasmUASTCToRGBA_UNORM = path + "scripts/uastc_rgba32_unorm.wasm";
                BABYLON.KhronosTextureContainer2.URLConfig.wasmUASTCToRGBA_SRGB = path + "scripts/uastc_rgba32_srgb.wasm";
            }
            if (window.useServiceWorker === true) {
                window.autoStartLoader = true; // Note: Allow Service Worker To Start The Scene Loader After Page Is Fully Loaded
                window.updateStatus("Please wait", "Starting scene loader", 0);
            } else {
                window.startSceneLoader();
            }
        } catch (ex3) {
            window.showErrorMessage(ex3.message || "Unknown Engine Exception");
        }
    };
    // ************************************************************************ //
    // DEFAULT LOADER - Initialize Default Scene Loading                        //
    // ************************************************************************ //
    window.onload = function() {
        window.setupBabylonEngineHostPage();
    };
    </script>
</body>
</html>
